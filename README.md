# ğŸ’² ì€í–‰ì°½êµ¬ ë§¤ë‹ˆì € *for Console-App User*ğŸ’¸


## ğŸ“– ëª©ì°¨

1. [ì†Œê°œ](#1.)
2. [íŒ€ì›](#2.)
3. [íƒ€ì„ë¼ì¸](#3.)
4. [íŒŒì¼íŠ¸ë¦¬](#4.)
5. [ì‹¤í–‰ í™”ë©´](#5.)
6. [íŠ¸ëŸ¬ë¸” ìŠˆíŒ…](#6.)
7. [íŒ€ íšŒê³ ](#7.)
8. [ì°¸ê³  ë§í¬](#8.)

<br>

<a id="1."></a>

## 1. ğŸ“¢ ì†Œê°œ

*Dear. `Console-App User Customer`*

`Bank`ì— ì—…ë¬´ë¥¼ ë³´ëŸ¬ ì˜¤ì…¨ë‚˜ìš”? *CommandLine*ì— ì›í•˜ì‹œëŠ” ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!
ì €í¬ `BankManager`ì—ê²Œ ëŒ€ê¸°ë²ˆí˜¸ë¥¼ ë°›ìœ¼ì‹œê³  ëŒ€ê¸°í•´ì£¼ì„¸ìš”.
`BankClerk`ì´ ì—…ë¬´ ì²˜ë¦¬ë¥¼ ë„ì™€ë“œë¦´ ê²ë‹ˆë‹¤!
    
> **í•µì‹¬ ê°œë… ë° ê²½í—˜**
> - LinkedListë¥¼ ì´ìš©í•œ Queue êµ¬í˜„
> - Queueì˜ UnitTest êµ¬í˜„
> - GCDë¥¼ ì´ìš©í•œ Concurrency í”„ë¡œê·¸ë˜ë°
> - Opaque and Boxed Typesì„ í™œìš©í•˜ì—¬ Queueì˜ ì¶”ìƒí™”

<br>

<a id="2."></a>

## 2. ğŸ‘¤ íŒ€ì›

| [Serena ğŸ·](https://github.com/serena0720) | [Erick ğŸ¦¦](https://github.com/h-suo) |
| :--------: | :--------: | 
| <Img src = "https://i.imgur.com/q0XdY1F.jpg" width="350"/>| <Img src = "https://user-images.githubusercontent.com/109963294/235300758-fe15d3c5-e312-41dd-a9dd-d61e0ab354cf.png" width="350"/>|

<br>

<a id="3."></a>
## 3. â±ï¸ íƒ€ì„ë¼ì¸

> í”„ë¡œì íŠ¸ ê¸°ê°„ :  2023.07.10 ~ 2023.07.21

|ë‚ ì§œ|ë‚´ìš©|
|:---:|---|
| **2023.07.10** |â–«ï¸ `Linked List` êµ¬í˜„ <br> â–«ï¸ `Linked List`ë¥¼ ì´ìš©í•œ `Queue` êµ¬í˜„ |
| **2023.07.11** |â–«ï¸ ì½”ë“œ ê°œì„ ì„ ìœ„í•œ ë¦¬í™í† ë§ |
| **2023.07.12** |â–«ï¸ ê³ ê°ì˜ ì—­í• ì„ í•˜ëŠ” `Customer` <br> â–«ï¸ ì€í–‰ì›ì˜ ì—­í• ì„ í•˜ëŠ” `BankClerk` êµ¬í˜„ <br> â–«ï¸ ì€í–‰ì˜ ì—…ë¬´ë¥¼ í•˜ê¸° ìœ„í•œ `Bank` êµ¬í˜„ <br> â–«ï¸ `Bank`ë¥¼ ê´€ë¦¬í•˜ëŠ” `BankManager` êµ¬í˜„ <br>|
| **2023.07.13** |â–«ï¸ ì½”ë“œ ê°œì„ ì„ ìœ„í•œ ë¦¬í™í† ë§ |
| **2023.07.14** |â–«ï¸ ì—…ë¬´ì˜ ì¢…ë¥˜ë¥¼ ë‚˜ëˆ„ê¸° ìœ„í•´ `WorkType` êµ¬í˜„ <br> â–«ï¸ ì€í–‰ì›ì˜ ì¸ì›ì— ë”°ë¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ êµ¬í˜„ <br> â–«ï¸ ì€í–‰ì›ì˜ `WorkType`ì— ë”°ë¼ ì—…ë¬´ë¥¼ ë‚˜ëˆ  ì£¼ëŠ” ë¡œì§ êµ¬í˜„ <br> â–«ï¸ README ì‘ì„± |
| **2023.07.16** |â–«ï¸ ì½”ë“œ ê°œì„ ì„ ìœ„í•œ ë¦¬í™í† ë§ <br> â–«ï¸ WorkTypeì— ì—…ë¬´ Name ì¶”ê°€|
| **2023.07.17** |â–«ï¸ HTTP ê°œì¸ ê³µë¶€<br> |
| **2023.07.18** |â–«ï¸ ì½”ë“œ ê°œì„ ì„ ìœ„í•œ ë¦¬í™í† ë§ <br> |
| **2023.07.19** |â–«ï¸ Queueë¥¼ protocol Queueableë¡œ ì¶”ìƒí™” <br> |

<br>

<a id="4."></a>
## 4. ğŸ“Š íŒŒì¼íŠ¸ë¦¬
<!-- <Img src = "" width="700"/> -->
```
BankManagerConsoleApp
â”œâ”€â”€ Bank
â”‚Â Â  â”œâ”€â”€ BankManager.swift
â”‚Â Â  â”œâ”€â”€ Bank.swift
â”‚Â Â  â”œâ”€â”€ BankClerk.swift
â”‚Â Â  â”œâ”€â”€ Customer.swift
â”‚Â Â  â”œâ”€â”€ CustomerQueue.swift
â”‚Â Â  â”œâ”€â”€ CustomerQueueable.swift
â”‚Â Â  â””â”€â”€ WorkType.swift
â”œâ”€â”€ Util
â”‚Â Â  â”œâ”€â”€ LinkedList.swift
â”‚Â Â  â”œâ”€â”€ Node.swift
â”‚Â Â  â””â”€â”€ Queueable.swift
â””â”€â”€ main.swift
```

<br>

<a id="5."></a>
## 5. ğŸ“² ì‹¤í–‰ í™”ë©´

| ì€í–‰ ê°œì  ì„ íƒ ì‹œ | ì€í–‰ ì—…ë¬´ ì¢…ë£Œ ì‹œ |
| :--------------: | :-------: | 
| <Img src = "https://github.com/h-suo/TIL/assets/109963294/4f6bc387-d0e6-4637-8b4c-b2083e09bf06" width="350"/> | <Img src = "https://hackmd.io/_uploads/r1DTZDAKh.gif" width="350"/>  |


<br>

<a id="6."></a>
## 6. ğŸ›ï¸ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### [ğŸ“ Step2 íŠ¸ëŸ¬ë¸” ìŠˆíŒ… ë³´ëŸ¬ê°€ê¸°](https://github.com/serena0720/ios-bank-manager/tree/step2#6-%EF%B8%8F-íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…)

## ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§ ì²˜ë¦¬
### ğŸ”¥ ë¬¸ì œì 
- ëŒ€ê¸°ì¤„ì˜ ê³ ê°ì„ ê° ì—…ë¬´ì— ë°°ì¹˜í•˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§ì„ ì–´ë–¤ ê°ì²´ì—ì„œ ì§„í–‰í•´ì•¼í• ì§€ì— ëŒ€í•œ ê³ ë¯¼ì„ í–ˆìŠµë‹ˆë‹¤.

### ğŸ§¯ í•´ê²°ë°©ë²•
- `Bank`ì—ì„œëŠ” `BankClerk`ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë¶€ì„œë³„ë¡œ `Deposit`ê³¼ `Loan`ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¡œì¨ `Bank`ì—ì„œëŠ” `BankClerk`ë³„ ë¶€ì„œë¥¼ ë‚˜ëˆ„ì–´, `clockIntoWork` ë©”ì†Œë“œì—ì„œ ê° ë¶€ì„œë³„ `BankClerk`ì—ê²Œ ì—…ë¬´ë¥¼ ì§€ì‹œí•˜ì˜€ìŠµë‹ˆë‹¤.
- ì§€ì‹œë¥¼ ë°›ì€ `BankClerk`ëŠ” `carryOutBankService`ì—ì„œ ë¶€ì„œë³„ ì—…ë¬´ ì¸ì›ì— ë§ì¶”ì–´ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.
    - ì´ë•Œ ë¶€ì„œë³„ ì—…ë¬´ ì¸ì›ì˜ ìˆ˜ë¥¼ `workType.numberOfBankClerk`ë¼ê³  ë„¤ì´ë°í•˜ì—¬, ê° ë¶€ì„œì— ë§ì¶”ì–´ `DispatchSemaphore`ì˜ ê°’ì„ ì§€ì •í•˜ì˜€ìŠµë‹ˆë‹¤.
- ê²°ë¡ ì ìœ¼ë¡œ ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§(ì—…ë¬´ ì¸ì›ì— ë§ì¶° ë™ì‹œì— ì¼ì„ ì‹œí‚¤ëŠ” ì‘ì—…)ì€ `BankClerk`ì—ì„œ í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.

<br>

## Semaphoreë¡œ Race Condition í•´ê²°
### ğŸ”¥ ë¬¸ì œì 
- ì´ì „ Stepì—ì„œ ì€í–‰ì›ì´ 1ëª…ì¼ ë•Œì™€ëŠ” ë‹¬ë¦¬ ì€í–‰ì›ì´ ì—¬ëŸ¬ëª…ì¼ ë•ŒëŠ” ë¹„ë™ê¸° ì‘ì—…ì„ ì–´ë–¤ì‹ìœ¼ë¡œ ì²˜ë¦¬í• ì§€ ê³ ë¯¼í–ˆìŠµë‹ˆë‹¤.
- `DispatchQueue`ì˜ `global().async`ëŠ” ì—¬ëŸ¬ ìŠ¤ë ˆë“œë¥¼ ìƒì„± ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ ìƒì„±ëœ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ìì›ì— ì ‘ê·¼í•˜ê²Œ ë˜ë©´ `Race Condition`ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ë©´ì„œ ìŠ¤ë ˆë“œ ì œí•œì„ í•´ì¤„ ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ê³ ë¯¼í–ˆìŠµë‹ˆë‹¤.

### ğŸ§¯ í•´ê²°ë°©ë²•
- `DispatchSemaphore`ëŠ” ì¹´ìš´íŒ… `Semaphore`ë¥¼ ì´ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤(ìŠ¤ë ˆë“œ)ì˜ ì ‘ê·¼ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ë©´ ë©€í‹° ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ì˜ ìì›ì— ì ‘ê·¼í•˜ë©´ì„œ ìƒê¸¸ ìˆ˜ ìˆëŠ” `Race Condition`ì„ ë°©ì§€í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
- ì´ëŸ¬í•œ `DispatchSemaphore`ë¥¼ ì´ìš©í•˜ì—¬ `DispatchSemaphore`ì˜ ê°’ì„ ì—…ë¬´ ì¢…ë¥˜ì— ë”°ë¥¸ ì€í–‰ì›ì˜ ìˆ˜ë¡œ ì„¤ì •í•˜ê³  `Wait()`ê³¼ `Signal()`ì„ ì‚¬ìš©í•˜ì—¬ ì€í–‰ì›(ìŠ¤ë ˆë“œ)ì´ ì—…ë¬´ ì¤‘ì—ëŠ” ë™ì‹œì— ë‹¤ë¥¸ ì—…ë¬´ë¥¼ í•  ìˆ˜ ì—†ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.
    ```swift
    self.semaphore = DispatchSemaphore(value: workType.numberOfBankClerk)

    // ...
    DispatchQueue.global().async(group: group) {
        semaphore.wait()

        startTask(customer.waitingNumber)
        Thread.sleep(forTimeInterval: workType.taskTime)
        endTask(customer.waitingNumber)

        semaphore.signal()
    }
    ```
<br>

## Queueableë¡œ Queueì˜ ì¶”ìƒí™”
### ğŸ”¥ ë¬¸ì œì 
- ê°ì²´ì§€í–¥ê³¼ í”„ë¡œí† ì½œ ì§€í–¥ ì¤‘ ì–´ë–¤ ê²ƒì´ ì •ë‹µì´ë¼ê³  ìƒê°í•˜ì§„ ì•Šì§€ë§Œ ì´ë²ˆì— ìƒˆë¡­ê²Œ `POP`ì— ëŒ€í•´ ë°°ìš°ë©´ì„œ í˜„ì¬ ì½”ë“œì— ëŒ€í•œ ê³ ë¯¼ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € `Queue`ë¥¼ í”„ë¡œí† ì½œë¡œ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•  ê²½ìš° ê°ì²´ê°€ ì—¬ëŸ¬ í”„ë¡œí† ì½œì„ ì±„íƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— `ë‹¤í˜•ì„±`ì„ í™•ë³´í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ìƒê¸´ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.
- ë˜í•œ `Queue`ë¥¼ `SOLID`ì›ì¹™ì— ë§ì¶”ì–´ ìˆ˜ì •í•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ í•˜ëŠ” ê³ ë¯¼ì„ í•˜ì˜€ìŠµë‹ˆë‹¤. `SOLID`ì›ì¹™ ì¤‘ `DIP`ì›ì¹™ì— ë”°ë¥´ë©´ 'êµ¬ì²´ì ì¸ ê°ì²´ê°€ ì•„ë‹Œ ì¶”ìƒì ì¸ ê°ì²´ì— ì˜ì¡´í•´ì•¼í•œë‹¤'ëŠ” ê²ƒê³¼ ë‹¬ë¦¬ í˜„ì¬ ì €í¬ ì½”ë“œëŠ” êµ¬ì²´ì ì¸ ê°ì²´ì¸ `Queue`ë¥¼ `Bank`ê°€ ì˜ì¡´í•˜ê³  ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

### ğŸ§¯ í•´ê²°ë°©ë²•
- ê¸°ì¡´ ìƒì„±í•œ `Queue`ëŠ” ì œë„¤ë¦­ íƒ€ì…ì„ ì‚¬ìš©í•˜ê³  ìˆì—ˆê¸°ì—, `Opaque and Boxed Types`ì„ í™œìš©í•˜ì—¬ `Queue`ì˜ ì¶”ìƒí™”í•˜ëŠ” ë°©ì‹ì„ ì±„íƒí•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ì¶”ìƒí™”í•œ `Queueable`ì€ `associatedtype`ìœ¼ë¡œ ì„ ì–¸ëœ `generic`íƒ€ì…ì´ ìˆê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì±„íƒí•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œ `where`ì ˆë¡œ íƒ€ì…ì„ ì œí•œì„ ì£¼ê±°ë‚˜ `Opaque and Boxed Types`ìœ¼ë¡œ í•´ê²°ì„ í•´ì•¼í•œë‹¤ ìƒê°í–ˆê¸°ë•Œë¬¸ì…ë‹ˆë‹¤.
- í•˜ì—¬ `Queueable`ì„ `Extension`ìœ¼ë¡œ ê¸°ë³¸ êµ¬í˜„ì„ í•œ ìƒíƒœì—ì„œ, ì¤‘ê°„ ê°ì²´ì¸ `CustomerQueue`ë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ `CustomerQueue`ê°€ `CustomerQueueable`ë¥¼ ì±„íƒí•˜ì—¬ `BankManager`ë¥¼ ìœ„í•œ `CustomQueue`ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
- `Bank`ì—ì„œ í˜¸ì¶œ ì‹œ `CustomerQueue`ë¥¼ `any`ë¡œ íƒ€ì…ì„ ê°ì‹¸ì„œ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
    <br>
    > ì˜ˆì‹œì½”ë“œ
    ```swift
    // Queueable ìƒì„± ì½”ë“œ
    protocol Queueable {
        associatedtype Element

        var linkedList: LinkedList<Element> { get }
        var peek: Element? { get }
        var isEmpty: Bool { get }

        func enqueue(_ value: Element)
        func dequeue() -> Element?
        func clear()
    }

    extension Queueable {
        var peek: Element? {
            let node = linkedList.head
            return node?.value
        }

        var isEmpty: Bool {
            return linkedList.head == nil
        }

        func enqueue(_ value: Element) {
            let node = Node(value: value)

            linkedList.append(node)
        }

        func dequeue() -> Element? {
            return linkedList.removeFirst()?.value
        }

        func clear() {
            linkedList.clear()
        }
    }
    ```
    ```swift
    // CustomerQueueable ìƒì„± ì½”ë“œ
    public protocol CustomerQueueable: Queueable where Element == Customer { }

    // CustomerQueue ìƒì„± ì½”ë“œ
    public struct CustomerQueue: CustomerQueueable {
        public let linkedList: LinkedList<Customer> = LinkedList()

        public init() {}
    }
    ```
    ```swift
    // CustomerQueueable í˜¸ì¶œ ë¶€
    struct Bank {
        ...
        private var waitingLine: any CustomerQueueable = CustomerQueue()
        ...
        }
    ```

<br>


<a id="7."></a> 
## 7. ğŸ’­ íŒ€ íšŒê³ 

<details>
<summary>íŒ€ íšŒê³ </summary>

- ì¶”í›„ ì—…ë°ì´íŠ¸ ì˜ˆì •
    
</details>

<br>

<a id="8."></a>
## 8. ğŸ”— ì°¸ê³  ë§í¬
- [ğŸ Apple Developer: DispatchSemaphore](https://developer.apple.com/documentation/dispatch/dispatchsemaphore)
- [ğŸ Apple Developer: Concurrency Programming Guide](https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html)
- [ğŸ Apple Developer: Opaque and Boxed Types](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/opaquetypes/)
- [ğŸ» ì•¼ê³°ë‹·ë„·: ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°](https://yagom.net/courses/ë™ì‹œì„±-í”„ë¡œê·¸ë˜ë°-concurrency-programming/)
- [ğŸ» ì•¼ê³°Blog: Swiftâ€“í”„ë¡œí† ì½œ ì§€í–¥ í”„ë¡œê·¸ë˜ë°](https://blog.yagom.net/531/)
